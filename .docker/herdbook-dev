# React build stage
FROM node:13 as build-stage

COPY ./frontend /build/

WORKDIR /build

RUN yarn install
RUN yarn run build

FROM python:3.8-buster

COPY app/requirements.txt /
RUN pip3 install -r /requirements.txt

COPY --from=build-stage /build/dist/index.html /static/
COPY --from=build-stage /build/dist/*.js /static/

WORKDIR /app

ENV HERDBOOK_CONFIG=/tmp/herdbook_config.ini
ENV FLASK_APP="herdbook.py"
ENV FLASK_ENV="development"
# CMD python3 -m flask run --host=0.0.0.0

CMD python3 herdbook.py
