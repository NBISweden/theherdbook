---

version: "3.4"
services:
    database:
        restart: always
        image: postgres:12
        container_name: herdbook-db
        environment:
            - POSTGRES_DB=herdbook
            - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-insecure}
            - POSTGRES_USER=herdbook
            - POSTGRES_HOST_AUTH_METHOD=trust
        volumes:
            - ./postgres-data:/var/lib/postgresql/data
        ports:
            - 5432:5432
    dev-server:
        build:
            context: ./
            dockerfile: .docker/herdbook-dev
        container_name: herdbook-server
        ports:
            - "4200:5000"
        volumes:
            - type: bind
              source: ./app
              target: /app
        depends_on:
            - database
    dev-frontend:
        build:
            context: ./frontend
        volumes:
            - type: bind
              source: ./frontend
              target: /frontend
            - /frontend/node_modules
            - /frontend/.parcel-cache
            - /frontend/.cache
        working_dir: /frontend
        ports:
            - 2345:2345
            - 2346:2346
